# 2장. 도메인, 서브도메인, 바운디드 컨텍스트 
- 도메인, 서브도메인, 바운디드 컨텍스트를 이해하며 큰 그림을 그려본다         
- 전략적 설계의 중요성 및 장점      

### 큰그림
> 도메인이란?         
> 소프트웨어가 해결해야할 문제 영역으로 한 조직이 행하는 일      
> 종류 : 핵심 도메인, 서브 도메인       
> 전체 도메인은 서버 도메인으로 이루어짐         

#### 서브도메인과 바운디드 컨텍스트의 활용 
Example) 온라인 쇼핑몰 (상품 판매 도메인)
> _전자상거래 시스템_ : 상품 카탈로그,  주문, 송장, 배송 도메인        
> _재고관리 시스템_ : 재고관리          
> _외부 예측 시스템_              
![ddd-1](/images/2019/12/ddd-1.png)

결과 > 제품 카탈로그, 주문, 송장, 배송 모델 등을 하나로 엮어서 복잡도가 높아지며 부정적인 결과를 초래

결론 > 소프트웨어의 관심을 논리적 모델(도메인)을 기준으로 분명하게 분리해야 함
모든 것이 서로 연결되 상호의존성을 갖기 때문에, 서브 도메인으로 구분하지 않을 경우 변화가 계속 될수록 큰 부담을 갖게됨

> 서브도메인     
> 항상 큰 크기와 기능을 가진 모델로 나누지 X      
> 일련의 알고리즘과 같은 같은 형태일 수 있음      
> 간단한 서브 도메인은 *모듈*을 통해 핵심 도메인과 구분 가능         
바운디드 컨텍스트 : 서브 도메인 = 1:1 (이상적)          

#### 핵심 도메인에 집중하기
> *핵심 도메인* : 조직의 성공에 가장 중요한 비즈니스 도메인의 한 부분 (가장 높은 우선순위 부여)      
> *바운디드 컨텍스트* : 비즈니스를 지원하기 위해 만들거나 차용       
> *지원 서브도메인* : 비즈니스에 필수적이지만, 핵심이 아닌 모델링     
> *범용 서브도메인* : 비즈니스적으로 특화된 부분은 없지만, 전체 비즈니스 솔루션에 필요한 도메인        
>![ddd-2](/images/2019/12/ddd-2.png) 

#### 전략적 설계의 중요성
팀이 전략적 설계를 이해하지 못해 공동적인 모델 설계를 애초부터 잘못 설계하게 됨        
결국, 빈약한 도메인이 만들어지며, DDD 실패 초래       

#### 현실의 도메인과 서브도메인 
- *문제점 공간(problem space)*
	- 전략적 비즈니스 문제점을 생각하게 만드는 공간
	- 새로운 핵심 도메인을 만들기 위해 개발하는 전체 도메인의 일부
	- 핵심 도메인 + 핵심 도메인을 사용하는 서브 도메인의 조합 

- *해결책 공간(solution space)*
	- 비즈니스 문제점을 소프트웨어를 구현하는 방법에 초점을 둠 
	- 하나 이상의 바운디드 컨텍스트
	- 바운디드 컨텍스트는 해결책을 소프트웨어로 실현시키는데 활용 

Example) 
> *핵심 도메인*: 최적 매입 컨텍스트      
> *구매 지원 서브 도메인* : 구매 컨텍스트, ERP 구매 모듈       
> *재고관리 지원 서브 도메인*: 재고 관리 컨텍스트, ERP 재고 모듈       
> *범용 서브 도메인* : 매핑 컨텍스트, ERP 구매 모듈 전체가 범용 서브도메인     
>![ddd-3](/images/2019/12/ddd-3.png) 


#### 바운디드 컨텍스트 이해하기     
> Bounded Context (바운디드 컨텍스트)       
> The delimited applicability of a particular model     
> Bounding contexts gives team members a clear and shared understanding of what has to be consistent and what can develop independently.        
도메인 문제를 해결하기 위한 도메인 모델이 존재하는 명시적 경계         
바운디드 컨텍스트는 명시적이고 언어적이다. // 이 경계를 기준으로 유비쿼터스 언어의 용어와 구문이전체적인 의미를 갖게 되고, 정확성을 보장하며 언어를 반영함        

[주의] 어떤 프로젝트에도 통용되는 포괄적인 모델을 생성하려 하려하지 말자       
모든 이해관계자로부터 동의를 얻기가 *불가능*하기 때문      

/컨텍스트가 왕이다/     

#### 모델 그 이상을 위해 
`도메인 모델` , `애플리케이션 서비스`, `비즈니스 서비스`  바운디드 컨텍스트 안에 포함관계이다. 

> 애플리케이션 서비스?       
> _사용자 인터페이스 컴포넌트, 서비스 중심 엔드포인트_ 두 경우 모두에 위임을 받음         
> 일반적으로 _보안, 트랜잭션 관리_ 를 제공하는 다른 서비스로 _퍼사드_ 로 사용         

* 안티 패턴: 스마트 UI 

바운디드 컨텍스트는 주로 유비쿼터스 언어와 도메인 모델을 캡슐화 함        
도메인 모델과의 상호작용과 지원을 위해 존재하는 다른 요소도 포함한다      

#### 바운디드 컨텍스트의 크기
바운디드 컨텍스트 크기  = 완전한 유비쿼터스 언어를 표현 가능한 크기         

*잘못된 크기의 바운디드 컨텍스트를 만들게 되는 이유?*     
1. 아키텍처적 영향을 기준으로 바운디드 컨텍스트를 나눴을 경우 언어적 경계가 아닌 _기술적 경계를 긋게됨_        
(플랫폼, 프레임워크 , 컴포넌트, 인프라스트럭처 …)      
2. 개발자 리소스로 작업을 분리하기 위해 바운디드 컨텍스트를 나눈 경우         

도메인 전문가가 얘기하는 언어에 따라 핵심 도메인에 초점을 두면, 하나의 응집된 모델과 자연스럽게 연결되는 컴포넌트를 찾을 수 있다.       

#### 기술적 컴포넌트로 정렬하기 (java)
최상위 단계 패키지 : 일반적으로 바운디드 컨텍스트의 `최상위 모듈 이름`을 따라간다         
Example)        
```
com.mycompany.optimalpurchasing    // bounded context
com.mycompany.optimalpurchasing.*presentation*	// UI
com.mycompany.optimalpurchasing.*application*	// application
com.mycompany.optimalpurchasing.*domain.model*	// domain
com.mycompany.optimalpurchasing.*infrastructure*	// infra
```
하나의 바운디드 컨텍스트 안 = 하나의 팀 작업       

#### 샘플 컨텍스트        
- 바운디드 컨텍스트 : 협업 컨텍스트, 식별자와 액세스 컨텍스트, 애자일 프로젝트 관리 컨텍스트       
>![ddd-4](/images/2019/12/ddd-4.png) 


> 열차사고      
> ( != 디미터의 법칙 )        
> 다수의 표현을 한줄에 줄지어 넣은 것       
> ex) user.persion().name().asFormatteName()       


### 마치며..
- 도메인 : 소프트웨어가 해결해야할 문제 영역으로 한 조직이 행하는 일    
- 서브 도메인        
- 바운디드 컨텍스트     
	- 적용가능한 범위를 정해 팀에게 명확하게 공유하고 지속적으로 독립적으로 개발할수있다.         
	- 도메인 문제를 해결하기 위한 도메인 모델이 존재하는 명시적 경계       
