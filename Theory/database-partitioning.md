## 데이터베이스 파티셔닝(DB Partitioning)
대용량화 되면서 DB 시스템 용량의 한계, 성능 저하가 자연스레 발생하게 되었다.
VLDB(Very Large DBMS)와 같이 하나의 DBMS에 너무 큰 table이 들어가며 용량, 성능 측면에서 많은 이슈가 발생하였다.
이러한 이슈 해결하기 위한 방법으로 table을 파티션이라는작은 단위로 나누어 관리하는 `파티셔닝(partitioning)` 이 생겨났다.
`데이터베이스를 분산처리하여 성능 저하 방지 및 관리 측면에 좋다`

#### 개념
- 논리적인 데이터 element를 다수의 entity로 쪼개는 행위
- 큰 table or index를 관리하기 쉬운 partition이라는 작은 단위로 물리적으로 분할하는 것을 말한다
(물리적으로 분할했음에도 DB에 접근하는 application입장에서는 인식하지 못한다)

#### 목적
1. 성능(Performance)
- 특정 DML, query의 성능 향상
- 주로 대용량 Data write 환경에서 효율적
- full scan에서 데이터 access의 범위를 줄여 성능 향상을 가져온다
- OLTP시스템에서 insert작업을 작은 단위인 partition으로 분산시켜 경합을 줄인다.

2. 가용성
- 전체 데이터의 훼손 가능성을 줄이고 데이터 가용성 향상시킨다
- 분할 영역을 독립적으로 백업하고 복구할 수 있다.

3. 관리용이성
- 큰 table들을 제거하여 관리를 쉽게해준다.

#### 장점
1. 관리적 측면 : partition 단위 백업, 추가, 삭제, 변경
- 전체 데이터를 손실할 가능성이 줄어들어 데이터 가용성이 향상
- partition별로 백업 및 복구가 가능
- partition 단위로 I/O분산이 가능하여 update 성능을 향상
2. 성능적 측면 : partition 단위 조회 및 DML수행
- 데이터 전체 검색 시 필요한 부분만 탐색해 성능이 증가한다.

#### 단점
1. table간의 join에 대한 비용 증가
2. table과 index를 별도로 파티셔닝할 수 없다.
(table, index를 같이 파티셔닝해야함)

#### 종류
1. 수평 파티셔닝
- 샤딩(Sharding)과 동일하다
- 스키마 복제 후 샤드키를 기준으로 데이터를 나누는 것을 말한다
- 스키마가 같은 데이터를 두개 이상의 테이블에 나누어 저장하는 것을 말함
- 퍼포먼스, 가용성을 위해 Key 기반으로 여러곳에 분산 저장을 한다
- 일반적으로 파티셔닝은 수평 분할을 의미한다
- 수평 분할을 한다고 했을때는 하나의 데이터베이스 안에서 이루어지는 경우를 지칭한다

- 장점
  - 데이터의 개수를 기준으로 나누어 파티셔닝
  - 데이터의 개수가 적어지고 index의 개수도 적어진다. (성능 향상)
- 단점
  - 서버간의 연결과정이 많아짐
  - 데이터를 찾는 과정이 기존보다 복잡해진다 (latency 증가)
  - 하나의 서버가 장애가 나면 데이터의 무결성이 깨질 수 있다.
2. 수직 파티셔닝
- 테이블의 일부 열을 빼내는 형태로 분할
- 스키마를 나누고 데이터가 따라 옮겨가는 것을 말한다
- 하나의 엔티티를 2개 이상으로 분리하는 작업
- 장점
  - 자주 사용하는 컬럼을 분리시켜 성능 향상

----
# 파티셔닝 분할 기준
데이터베이스 관리 시스템은 분할에 대해 각종 분할 기법을 제공하고 있다.
분할은 `분할 키`를 사용한다.
1. 범위 분할 (range partitioning)
2. 목록 분할 (list partitioning)
3. 해시 분할 (hash partitioning)
4. 합성 분할 (composite partition)


---
# 데이터베이스 샤딩(Database Sharding)
- 같은 테이블 스키마를 가진 데이터를 다수 데이터베이스에 분산하여 저장하는 방법
- Horizontal partitioning과 비슷하다

#### 샤딩을 적용하기 전에 try하면 좋을 것
샤딩을 적용하면 프로그래밍, 운영 복잡도가 높아지는 단점이 있다.
- scale-in : 하드웨어 스펙이 좋은 것을 사용한다
- read 부하가 크다면? cache나 database replication을 적용한다 (방법 1)
- table의 일부 컴럼만 자주 사용하는 경우?
1. vertically partition도 하나의 방법
2. data를 hot, warm, cold data로 분리

https://nesoy.github.io/articles/2018-05/Database-Shard
https://hanburn.tistory.com/106
샤딩(sharding), 파티션(partition), 리플리카(replica)
파티셔닝
수평(horizontal) 파티션
퍼포먼스, 가용성을 위해 KEY 기반으로 여러곳에 분산저장
일반적으로 분산 저장기술에서 파티셔닝은 수평분할을 의미한다.
수직(vertical) 파티션
하나의 엔티티를 2개 이상으로 분리하는 작업
관계형 DB에서 3정규화와 같은 개념으로 접근하면 이해가 용이하다.

리플리카는 또 다른 샤딩으로 이해하자.
물리적으로 분산된 샤드(노드)의 장애복구를 위해, 또 다른 복제본을 두는것을 의미한다.
값이 2라면 primary를 제외한 복제본 2개를 또 다른 어딘가에 저장한다는 뜻이다.
